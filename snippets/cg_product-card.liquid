{%- comment -%}
  Renders a product card

  Accepts:
  - product: {Object} Product Liquid object (optional)
  - lazy_load: {Boolean} Image should be lazy loaded. Default: true (optional)
  - image_ratio: {String} Size of the product image card. Values are "square", "landscape" and "portrait". Default is "square" (optional)
  - image_fill: {Boolean} Zoom image to fill space. Default: false (optional)
  - show_secondary_image: {Boolean} Show the secondary image on hover. Default: false (optional)
  - show_vendor: {Boolean} Show the product vendor. Default: false
  - show_rating: {Boolean} Show the product rating. Default: false
  - show_countdown: {Boolean} Show the countdown timer.
  - show_quick_add: {Boolean} Show the quick add button.
  - show_quick_view: {Boolean} Show the quick view button.
  - show_color_swatches: {Boolean} Show the color swatches.
  - show_save_amount: {Boolean} Show save amount.
  - amount_type: {String} Save amount type.
  - section_id: {String} The ID of the section that contains this card.

  Usage:
  {% render 'product-card', show_vendor: section.settings.show_vendor %}

  Adjusted by CLEARgo
{%- endcomment -%}

{% style %}
  .product-card secondary-medias, 
  .product-card__media img { 
    width: 100%; 
    aspect-ratio: 604 / 432; 
    background-size: contain; 
    background-position: center; 
    object-fit: contain; 
  }

  .product-card h3:has(.product-card__title) { 
    display: flex; 
    margin-bottom: calc(8vw / 19.2); 
  }

  .product-card .product-card__title {
    font-size: calc(28vw / 19.2); 
  }

  .product-card .product-card_description { 
    height: 30px; 
    margin-bottom: calc(8vw / 19.2); 
    line-height: 100%; 
    color: var(--color-grey-2); 
    font-size: 15px; 
    overflow: hidden; 
  }

  .product-card .badges { 
    gap: calc(8vw / 19.2); 
  }
  
  .product-card .product-card__rating { 
    gap: calc(4vw / 19.2); 
  }

  .product-card .product-card__rating .star { 
    width: calc(12vw / 19.2); 
    height: calc(12vw / 19.2); 
    aspect-ratio: 1; 
  }

  .product-card .product-card__rating .star:before { 
    content: ''; 
    width: 100%; 
    height: 100%; 
    display: block; 
    background-image: url({{ 'star.svg' | asset_url }}); 
    background-size: cover; 
    background-position: left; 
  }

  .product-card .review-counter { 
    display: flex; 
    gap: calc(6vw / 19.2); 
    align-items: flex-end; 
  }

  .product-card .review-count { 
    font-size: 12px; 
  }

  .product-card .varient-image-item { 
    display: none; 
  }

  .product-card .varient-image-item.active { 
    display: block; 
  }

  .product-card .swatches { 
    gap: calc(14vw / 19.2); 
    margin-bottom: calc(36vw / 19.2); 
    padding-block: 8px; 
  }

  .product-card .swatches li { 
    border-radius: 50%; 
  }

  .product-card .swatches li.active { 
    outline: 1px solid var(--color-black); 
    outline-color: var(--swatch-background); 
    outline-offset: calc(6vw / 19.2); 
  }

  .product-card .product-card__pricing { 
    height: 60px; 
    margin-bottom: 18px; 
  }

  .product-card .product-card__pricing button { 
    font-size: calc(16vw / 19.2); 
    white-space: nowrap; 
  }

  .product-card .product-card__spec .info_row { 
    display: flex; 
    justify-content: space-between; 
    gap: calc(34vw / 19.2); 
  }

  .product-card .product-card__spec .info_row .info_col { 
    flex: 1; 
  }

  .product-card .product-card__spec .info_row .col-title { 
    white-space: nowrap; 
    /* font-size: calc(14vw / 19.2); */
    font-size: 14px; 
    color: var(--color-grey-2); 
  }

  .product-card .product-card__spec .info_row .col-content { 
    white-space: nowrap; 
    font-size: calc(18vw / 19.2); 
    font-weight: 600; 
  }

  .quick-add .button {
    white-space: nowrap; 
  }
  
  .quick-add .button .icon-cart { 
    display: none; 
  }

  .quick-add:has([disabled="disabled"]) button {
    border: none; 
  }

  .product-card__bottom {
    justify-content: space-between; 
  }

  .certified-badges {
    display: flex; 
    gap: 8px; 
  }

  .certified-badge img { 
    width: 36px; 
    height: 36px; 
    aspect-ratio: 1; 
    object-fit: contain; 
  }

  .product-card .variant-images, 
  .product-card .varient-image-item, 
  .product-card .varient-image-item img {
    width: 100%; 
    height: auto; 
    aspect-ratio: 1080 / 678; 
    object-fit: contain; 
    overflow: hidden; 
  }

  /* Reponsive */
  /* Mobile */
  @media (max-width: 767px) { 
    .product-card .product-card__title { 
      font-size: 20px; 
    }

    .product-card .product-card_description { 
      height: 24px; 
      /* font-size: 10px; */
      font-size: 12px; 
      margin-bottom: 8px; 
    }

    .product-card .badges { 
      gap: 4px; 
    }

    .product-card .product-card__pricing {
      height: 40px; 
      margin-bottom: 10px; 
    }

    .product-card .product-card__pricing button { 
      width: fit-content !important; 
      padding: 8px 12px !important; 
      font-size: 12px; 
    }

    .product-card .product-card__rating { 
      gap: 2px; 
    }

    .product-card .product-card__rating .star { 
      width: 6px; 
      height: 6px; 
    }

    .product-card .review-counter { 
      gap: 6px; 
    }

    .product-card .review-count { 
      font-size: 8px; 
    }

    .product-card .swatches { 
      gap: 8px; 
      margin-bottom: 24px; 
    }

    .product-card .product-card__spec .info_row { 
      /* gap: 16px; */
      /* flex-wrap: wrap; */
      gap: 4px; 
    }

    .product-card .product-card__spec .info_row .col-title { 
      font-size: 12px; 
    }

    .product-card .product-card__spec .info_row .col-content { 
      font-size: 12px; 
    }

    .quick-add .button:not([disabled]) {
      padding: 8px; 
    }

    .quick-add .button .icon-cart { 
      display: block !important; 
      width: 12px; 
      height: 12px; 
      aspect-ratio: 1; 
    }

    .quick-add .button .btn-text > span {
      display: none; 
    }

    .quick-add:has([disabled="disabled"]) button {
      transform: translateY(-25%); 
    }

    .certified-badges {
      gap: 4px; 
    }

    .certified-badge img { 
      width: 18px; 
      height: 18px; 
    }

    .product-card .swatches li.active { 
      outline-offset: 2px !important; 
    }
  }

  /* Tablets */
  @media (min-width: 768px) and (max-width: 1366px) { 
    .product-card h3:has(.product-card__title) { 
      margin-bottom: calc(8vw / 13.66); 
    }

    .product-card .product-card__title { 
      font-size: calc(28vw / 13.66); 
    }

    .product-card .product-card_description { 
      margin-bottom: calc(8vw / 13.66); 
    }

    .product-card .badges { 
      gap: calc(8vw / 13.66); 
    }

    .product-card .product-card__pricing button { 
      padding: calc(12vw / 19.2) calc(32vw / 19.2); 
      font-size: calc(16vw / 13.66); 
    }
    
    .product-card .product-card__rating { 
      gap: calc(4vw / 13.66); 
    }

    .product-card .product-card__rating .star { 
      width: calc(12vw / 13.66); 
      height: calc(12vw / 13.66); 
    }

    .product-card .review-counter { 
      gap: calc(6vw / 13.66); 
    }

    .product-card .review-count { 
      font-size: 12px; 
    }

    .product-card .swatches { 
      gap: calc(14vw / 13.66); 
      margin-bottom: calc(36vw / 13.66); 
    }

    .product-card .swatches li.active { 
      outline-offset: calc(6vw / 13.66); 
    }

    .product-card .product-card__spec .info_row { 
      gap: calc(34vw / 13.66); 
    }

    .product-card .product-card__spec .info_row .info_col { 
      /* width: calc((100% - (114vw / 19.2)) / 4); */
    }

    .product-card .product-card__spec .info_row .col-title { 
      font-size: calc(14vw / 13.66); 
    }

    .product-card .product-card__spec .info_row .col-content { 
      font-size: calc(18vw / 13.66); 
    }
  }

  /* Desktop */
  @media (min-width: 1920px) { 
    .product-card .product-card__media, 
    .product-card .product-card__media *, 
    .product-card .product-card__content { 
      /* max-width: 602px; */
      max-width: 460px; 
    }

    .product-card h3:has(.product-card__title) { 
      margin-bottom: 8px; 
    }

    .product-card .product-card__title { 
      font-size: 28px; 
    }

    .product-card .product-card_description { 
      margin-bottom: 8px; 
    }
    
    .product-card .badges { 
      gap: 8px; 
    }

    .product-card .product-card__pricing button { 
      padding: 12px 32px; 
      font-size: 16px; 
    }

    .product-card .product-card__rating { 
      gap: 4px; 
    }

    .product-card .product-card__rating .star { 
      width: 12px; 
      height: 12px; 
    }

    .product-card .review-counter { 
      gap: 6px; 
    }

    .product-card .review-count { 
      font-size: 12px; 
    }

    .product-card .swatches { 
      gap: 14px; 
      margin-bottom: 36px; 
    }

    .product-card .swatches li.active { 
      outline-offset: 6px; 
    }

    .product-card .product-card__spec .info_row { 
      gap: 34px; 
    }

    .product-card .product-card__spec .info_row .info_col { 
      /* width: calc((100% - 114px) / 4); */
    }

    .product-card .product-card__spec .info_row .col-title { 
      font-size: 14px; 
    }

    .product-card .product-card__spec .info_row .col-content { 
      font-size: 18px; 
    }
  }
{% endstyle %}

{%- if product != blank -%}
  {%- liquid
    assign featured_media = product.featured_media

    assign product_url = product.url | within: collection
    if settings.product_disable_collection_portion
      assign product_url = product.url
    endif
  -%}
  <div class="card product-card-{{ product.id }} product-card product-card--{{ settings.card_style }}{% if settings.card_border_thickness > 0 %} product-card--thickness{% endif %}{% unless featured_media %} no-media{% endunless %}{% if product.available and show_quick_add and mobile_quick_add %} mobile:with-quick-add{% endif %} leading-none relative overflow-hidden">
    {%- if featured_media -%}
      <div class="product-card__media relative">
        {% comment %}
        {%- if show_quick_view -%}
          <button type="button" class="quick-view__button button button--secondary z-2 absolute top-0 right-0 opacity-0" is="hover-button" aria-controls="Quickview-{{ section_id }}-{{ block_id }}-{{ product.id }}" aria-expanded="false">
            <span class="btn-fill" data-fill></span>
            <span class="btn-text">
              {%- render 'icon', icon: 'eye', size: 'sm' -%}
              <span class="sr-only">{{ 'products.product.quick_view' | t }}</span>
            </span>
          </button>
          <quick-view id="Quickview-{{ section_id }}-{{ block_id }}-{{ product.id }}" class="quick-view x-modal drawer z-30 fixed bottom-0 left-0 h-full w-full pointer-events-none" data-product-url="{{ product_url }}" role="dialog" aria-label="{{ 'products.product.choose_product_options' | t: product_name: product.title | escape }}" aria-modal="true">
            <overlay-element class="overlay fixed-modal invisible opacity-0 fixed bottom-0 left-0 w-full h-screen pointer-events-none" aria-controls="Quickview-{{ section_id }}-{{ block_id }}-{{ product.id }}" aria-expanded="false"></overlay-element>
            <div class="drawer__inner z-10 absolute top-0 flex flex-col w-full h-full overflow-hidden">
              <gesture-element class="drawer__header flex items-center justify-between opacity-0 invisible relative">
                <button class="button button--secondary button--close drawer__close z-1 absolute top-0 right-0 flex items-center justify-center opacity-0" type="button" is="hover-button" aria-controls="Quickview-{{ section_id }}-{{ block_id }}-{{ product.id }}" aria-expanded="false" aria-label="{{ 'general.accessibility.close' | t | escape }}">
                  <span class="btn-fill" data-fill></span>
                  <span class="btn-text">
                    {%- render 'icon', icon: 'close', size: 'sm' -%}
                  </span>
                </button>
              </gesture-element>
              <div class="quick-view__content drawer__content opacity-0 invisible flex flex-col h-full grow shrink"></div>
            </div>
          </quick-view>
        {%- endif -%}
        {% endcomment %}

        {%- render 'product-badges', product: product, show_save_amount: show_save_amount, save_type: save_type, class: 'z-2 absolute grid gap-3' -%}

        <a class="block relative media {% unless image_fill %} media--contain{% endunless %}{% unless show_secondary_image and product.media.size > 1 %} overflow-hidden{% endunless %}" href="{{ product_url }}" tabindex="-1">
          {%- unless featured_media.media_type == 'video' or featured_media.media_type == 'external_video' -%}
            {%- if show_secondary_image and product.media.size > 1 -%}
              {% comment %}
              <template>
                {%- for media in product.media limit: 4 -%}
                  <div class="media media--height{% unless image_fill %} media--contain{% endunless %} w-full h-full">
                    {{- media | image_url: width: media.width | image_tag: loading: 'lazy', widths: '180,360,540,720,900,1080', is: 'lazy-image' -}}
                  </div>
                {%- endfor -%}
              </template>
              {% endcomment %}
              {% comment %}
              <secondary-medias class="product-card__carousels block absolute top-0 left-0 w-full h-full hidden md:block"></secondary-medias>
              {% endcomment %}
            {%- endif -%}
            {% comment %}
            {% if product.variants.size > 1 %}
            {%- assign variant_image = product.selected_or_first_available_variant.image -%}
            {{- variant_image | image_url: width: variant_image.width | image_tag: loading: 'lazy', widths: '180,360,540,720,900,1080', is: 'lazy-image' -}}
            {% else %}
              {{- featured_media | image_url: width: featured_media.width | image_tag: loading: 'lazy', widths: '180,360,540,720,900,1080', is: 'lazy-image' -}}
            {% endif %}
            {% endcomment %}
            <ul class="variant-images" {% comment %}style="display:none;"{% endcomment %}>
              {% for variant in product.variants %}
                {% comment %}
                  <p>Options: </p>
                  <ul>
                    {% for option in variant.options %}
                      <li>{{ option }}</li>
                    {% endfor %}
                  </ul>
                  <p>index: {{ forloop.index }} | variant: {{ variant.title }} | ID: {{ variant.id }}</p>
                {% endcomment %}
                <li class="varient-image-item {% if forloop.first %}active{% endif %}" 
                  data-color='[
                    {% for option in variant.options %}
                      "{{ option }}"
                      {% unless forloop.last %}, {% endunless %}
                    {% endfor %}
                  ]'
                >
                  {% assign variant_image = variant.featured_image | img_url: 'master' | replace : '//www.','https:' %}
                  {% if variant.featured_media != blank %}
                    {{- variant.featured_media | image_url: width: featured_media.width | image_tag:widths: '180,360,540,720,900,1080',data-image: variant_image -}}
                  {% else %}
                    {{- product.featured_media | image_url: width: featured_media.width | image_tag:widths: '180,360,540,720,900,1080' -}}
                  {% endif %}
                </li>
              {% endfor %}
            </ul>
            {%- else -%}
            {%- render 'product-video',
              video: featured_media,
              muted: false,
              autoplay: false,
              loop: false,
              cover_image: featured_media,
              show_play_button: true,
              class: 'relative w-full overflow-hidden'
            -%}
          {%- endunless -%}
        </a>

        {% comment %}
        {%- if product.available -%}
          {%- if show_quick_add -%}
            <div class="quick-add flex justify-end md:justify-center absolute w-full z-1 pointer-events-none">
              {%- if product.variants.size == 1 -%}
                {%- capture product_form_id -%}QuickAddProductForm-{{ section_id }}-{{ product.id }}{%- endcapture -%}
                {%- form 'product', product, is: 'product-form', id: product_form_id -%}
                  <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}" />
                  {%- liquid
                    if product.template_suffix != 'pre-order'
                      assign quick_add_label = 'products.product.add_to_cart' | t
                    else
                      assign quick_add_label = 'products.product.pre_order' | t
                    endif
                  -%}
                  <button type="submit" class="button button--primary pointer-events-auto md:opacity-0" is="hover-button" data-variant-id="{{ product.selected_or_first_available_variant.id }}" aria-label="{{ quick_add_label | escape }}">
                    <span class="btn-fill" data-fill></span>
                    <span class="btn-text">
                      {%- render 'icon', icon: 'cart', size: 'sm', class: 'md:hidden' -%}
                      <span class="hidden md:block" data-sold-out="{{ 'products.product.sold_out' | t | escape }}">
                        {{- quick_add_label -}}
                      </span>
                    </span>
                  </button>
                {%- endform -%}
              {%- else -%}
                {%- if show_quick_view -%}
                  <button type="button" class="button button--primary pointer-events-auto md:opacity-0" is="hover-button" aria-controls="Quickview-{{ section_id }}-{{ block_id }}-{{ product.id }}" aria-expanded="false" aria-label="{{ 'products.product.choose_options' | t | escape }}">
                    <span class="btn-fill" data-fill></span>
                    <span class="btn-text">
                      {%- render 'icon', icon: 'cart', size: 'sm', class: 'md:hidden' -%}
                      <span class="hidden md:block">
                        {{- 'products.product.choose_options' | t -}}
                      </span>
                    </span>
                  </button>
                {%- else -%}
                  <a href="{{ product_url }}" class="button button--primary pointer-events-auto md:opacity-0" is="hover-link" aria-label="{{ 'products.product.view_product' | t | escape }}">
                    <span class="btn-fill" data-fill></span>
                    <span class="btn-text">
                      {%- render 'icon', icon: 'cart', size: 'sm', class: 'md:hidden' -%}
                      <span class="hidden md:block">
                        {{- 'products.product.view_product' | t -}}
                      </span>
                    </span>
                  </a>
                {%- endif -%}
              {%- endif -%}
            </div>
          {%- endif -%}
        {%- else -%}
          <div class="quick-add flex justify-center absolute w-full z-1 pointer-events-none">
            <button type="button" class="button button--secondary button--blur" disabled="disabled">
              {{- 'products.product.sold_out' | t -}}
            </button>
          </div>
        {%- endif -%}
        {% endcomment %}

        {%- if show_countdown and product.metafields.theme.countdown.value != blank -%}
          {%- liquid
            assign now_time = 'now' | date: '%s' | times: 1
            assign countdown_time = product.metafields.theme.countdown.value | date: '%s' | times: 1
          -%}
          {%- if countdown_time > now_time -%}
            <div class="product-card__countdown sm:flex justify-center absolute w-full z-0 pointer-events-none">
              <div class="button icon-with-text">
                <div class="btn-text">
                  {% comment %}
                  <svg class="icon icon-countdown icon-sm flex-auto md:block" viewBox="0 0 20 20" stroke="currentColor" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-miterlimit="10" d="M4.15002 10.3833C4.15002 8.95831 4.57502 7.56665 5.36669 6.37498C6.15835 5.19165 7.28335 4.26665 8.60002 3.71665C9.91669 3.17498 11.3667 3.02498 12.7667 3.30831C14.1667 3.58331 15.45 4.27498 16.4584 5.28331C17.4667 6.29165 18.15 7.57498 18.4334 8.97498C18.7084 10.375 18.5667 11.825 18.025 13.1416C17.4834 14.4583 16.5584 15.5833 15.3667 16.375C14.1834 17.1666 12.9167 17.5 11.3584 17.5916M11.1084 10.8333L14.4417 7.36665M1.66669 13.2666H8.13335M3.85835 16H8.13335M5.85002 18.7333H8.13335M12.3584 0.983313C11.5417 0.783313 10.6917 0.783313 9.87502 0.983313"/>
                  </svg>
                  {% endcomment %}
                   <svg class="icon icon-countdown icon-sm flex-auto md:block" viewBox="0 0 20 20" stroke="currentColor" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-miterlimit="10" d="M4.15002 10.3833C4.15002 8.95831 4.57502 7.56665 5.36669 6.37498C6.15835 5.19165 7.28335 4.26665 8.60002 3.71665C9.91669 3.17498 11.3667 3.02498 12.7667 3.30831C14.1667 3.58331 15.45 4.27498 16.4584 5.28331C17.4667 6.29165 18.15 7.57498 18.4334 8.97498C18.7084 10.375 18.5667 11.825 18.025 13.1416C17.4834 14.4583 16.5584 15.5833 15.3667 16.375C14.1834 17.1666 12.9167 17.5 11.3584 17.5916M11.1084 10.8333L14.4417 7.36665M1.66669 13.2666H8.13335M3.85835 16H8.13335M5.85002 18.7333H8.13335M12.3584 0.983313C11.5417 0.783313 10.6917 0.783313 9.87502 0.983313"></path>
                  </svg>

                  <card-countdown-timer
                    class="flex gap-3"
                    data-year="{{ product.metafields.theme.countdown.value | date: "%Y" }}"
                    data-month="{{ product.metafields.theme.countdown.value | date: "%m" }}"
                    data-day="{{ product.metafields.theme.countdown.value | date: "%d" }}"
                    data-hour="{{ product.metafields.theme.countdown.value | date: "%H" }}"
                    data-minute="{{ product.metafields.theme.countdown.value | date: "%M" }}"
                    data-compact="true"
                  >
                    <div class="countdown__item">
                      <p>--{{ 'general.date.d' | t }}</p>
                    </div>
                    <div class="countdown__item">
                      <p>--{{ 'general.date.h' | t }}</p>
                    </div>
                    <div class="countdown__item">
                      <p>--{{ 'general.date.m' | t }}</p>
                    </div>
                    <div class="countdown__item">
                      <p>--{{ 'general.date.s' | t }}</p>
                    </div>
                  </card-countdown-timer>
                </div>
              </div>
            </div>
          {%- endif -%}
        {%- endif -%}
      </div>
    {%- else -%}
      <div class="product-card__media h-auto overflow-hidden">
        <span class="block aspect-{{ image_ratio }}"></span>
      </div>
    {%- endif -%}
    <div class="product-card__content flex flex-col{% if featured_media %} justify-start text-{{ settings.card_text_alignment }}{% else %} justify-center items-center absolute top-0 left-0 w-full h-full{% endif %}">
      {%- if show_vendor -%}
        <div class="product-card__top w-full">
          <span class="sr-only">{{ 'general.accessibility.vendor' | t }}</span>
          {{- product.vendor | link_to_vendor : class: "caption reversed-link uppercase leading-none tracking-widest" -}}
        </div>
      {%- endif -%}
      <h3 class="grow">
        <a class="product-card__title text-base-xl font-medium leading-tight" href="{{ product_url }}">
          {{- product.title | escape -}}
        </a>
      </h3>
      {%- if product.metafields.custom.pdc_description != blank -%}
        <p class="product-card_description">{{ product.metafields.custom.pdc_description }}</p>
      {%- endif -%}

      {%- if show_rating -%}
        {%- liquid
          assign rating_max = 5
          
          if product.metafields.reviews.rating.value != blank
            assign rating_value = product.metafields.reviews.rating.value.rating | round: 1
            assign rating_count = product.metafields.reviews.rating_count.value
            assign rating_max = product.metafields.reviews.rating.value.scale_max
          elsif show_empty
            assign rating_value = 0.0
            assign rating_count = 0
          elsif show_placeholder
            assign rating_value = 4.5
            assign rating_count = 2
          else
            assign hide_rating = true
          endif
        -%}

        <div class="review-counter">
          {%- unless hide_rating -%}
            <ul class="rating product-card__rating" title="{{ 'general.accessibility.star_reviews_count' | t: count: rating_count | escape }}">
              {% comment %}
                {%- liquid
                  if display_mode == 'count'
                    echo 'general.accessibility.star_reviews_count' | t: count: rating_count
                  else
                    echo rating_value
                  endif
                -%}
              {% endcomment %}

              {% for i in (1..5) %}
                {% if rating_value >= forloop.index %}
                  <li class="star"></li>
                {% endif %}
              {% endfor %}
              
              {% assign rating_remainder = rating_value | modulo: 1 %}
              {% if rating_remainder > 0 %}
                <li class="star crop"></li>
                {% style %}
                  .product-card .product-card__rating .star.crop:before { 
                    width: {{ rating_remainder | times: 100 }}%; 
                  }
                {% endstyle %}
              {% endif %}
            </ul>
          {%- endunless -%}
          {% if shop.metafields.judgeme.all_reviews_count != blank %}
            <span class="review-count">{{ shop.metafields.judgeme.all_reviews_count }}{{ 'general.accessibility.reviews_count' | t }}</span>
          {% endif %}
        </div>
      {%- endif -%}

      {%- if show_color_swatches -%}
        {%- liquid
          assign swatch_trigger = 'products.general.color_swatch_trigger' | t | downcase
          assign swatch_file_extension = 'png'
          assign color_count = 0
        -%}
        {%- for option in product.options_with_values -%}
          {%- liquid
            assign option_name = option.name | downcase
            assign is_color = false
            if option_name contains swatch_trigger
              assign is_color = true
            elsif swatch_trigger == 'color' and option_name contains 'colour'
              assign is_color = true
            endif
          -%}
          {%- if is_color -%}
            {%- liquid
              assign option_index = forloop.index0
              assign values = ''
              assign max_color_count = settings.product_max_color_swatches
            -%}
            <div class="product-card__bottom flex items-center gap-2">
              <ul class="swatches swatches--{{ settings.rounded_swatch }} swatches--{{ product.id }} inline-flex items-center gap-2">
                {%- for variant in product.variants -%}
                  {%- assign value = variant.options[option_index] %}
                  {%- unless values contains value -%}
                    {%- liquid
                      assign values = values | join: ',' | append: ',' | append: value | split: ','
                      assign color_count = color_count | plus: 1
                      assign color_title = product.title | append: ' - ' | append: value
                      assign color_url = variant.url | within: collection
                      if settings.product_disable_collection_portion
                        assign color_url = variant.url
                      endif
                    -%}
                    {%- if color_count <= max_color_count -%}
                      <li data-color='[
                        {% for option in variant.options %}
                          "{{ option }}"
                          {% unless forloop.last %}, {% endunless %}
                        {% endfor %}
                      ]'>
                        {%- render 'swatch', href: color_url,index:forloop.index, variant:variant,title: color_title, value: value, file_extension: swatch_file_extension -%}
                      </li>
                    {%- endif -%}
                  {%- endunless -%}
                {%- endfor -%}
              </ul>
              <ul class="certified-badges">
                {% if product.metafields.custom.ul_certified_badge.value == true %}
                  <li class="certified-badge ul-certified-badge">
                    <img width="36" height="36" src="{{ 'ul-certified-icon.png' | asset_url }}" />
                  </li>
                {% endif %}
                {% if product.metafields.custom.tuv.value == true %}
                  <li class="certified-badge tuv-certified-badge">
                    <img width="36" height="36" src="{{ 'tuv-certified-icon.png' | asset_url }}" />
                  </li>
                {% endif %}
              </ul>
              {%- if color_count > max_color_count -%}
                <a href="{{ product_url }}" class="reversed-link font-medium text-xs text-opacity leading-none tracking-widest" is="hover-link" aria-controls="Quickview-{{ section_id }}-{{ block_id }}-{{ product.id }}" aria-expanded="false">+{{ color_count | minus: max_color_count }}</a>
              {%- endif -%}
            </div>
            {%- if color_count < 1 -%}
              <style>
                .swatches--{{ product.id }} { display: none; }
              </style>
            {%- endif -%}
          {%- endif -%}
        {%- endfor -%}
      {%- endif -%}
      
      <div class="product-card__details flex flex-col items-baseline gap-2 w-full">
        {% comment %}
        <p class="grow">
          <a class="product-card__title reversed-link text-base-xl font-medium leading-tight" href="{{ product_url }}">
            {{- product.title | escape -}}
          </a>
        </p>
        {% endcomment %}
        <div class="product-card__pricing flex w-full justify-between">
          {%- render 'product-price', product: product, class: 'flex items-center gap-2' -%}
          {%- if product.available -%}
            {%- if show_quick_add -%}
              <div class="quick-add pointer-events-none">
                {%- if product.variants.size == 1 -%}
                  <a href="{{ product_url }}" class="button button--primary pointer-events-auto" is="hover-link" aria-label="{{ 'products.product.view_product' | t | escape }}">
                    <span class="btn-fill" data-fill></span>
                    <span class="btn-text">
                    {% comment %}{%- render 'icon', icon: 'cart', size: 'sm', class: 'md:hidden' -%}
                      <svg class="icon icon-cart icon-lg" viewBox="0 0 24 24" stroke="currentColor" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M1 1h.5v0c.226 0 .339 0 .44.007a3 3 0 0 1 2.62 1.976c.034.095.065.204.127.42l.17.597m0 0 1.817 6.358c.475 1.664.713 2.496 1.198 3.114a4 4 0 0 0 1.633 1.231c.727.297 1.592.297 3.322.297h2.285c1.75 0 2.626 0 3.359-.302a4 4 0 0 0 1.64-1.253c.484-.627.715-1.472 1.175-3.161l.06-.221c.563-2.061.844-3.092.605-3.906a3 3 0 0 0-1.308-1.713C19.92 4 18.853 4 16.716 4H4.857ZM12 20a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm8 0a2 2 0 1 1-4 0 2 2 0 0 1 4 0Z"></path>
                      </svg>
                    {% endcomment %}

                    {%- render 'icon', icon: 'cart' -%}
                    <span>
                      {{- 'products.product.view_product' | t -}}
                    </span>
                    </span>
                  </a>
                  {% comment %}
                    {%- capture product_form_id -%}QuickAddProductForm-{{ section_id }}-{{ product.id }}{%- endcapture -%}
                    {%- form 'product', product, is: 'product-form', id: product_form_id -%}
                      <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}" />
                      {%- liquid
                        if product.template_suffix != 'pre-order'
                          assign quick_add_label = 'products.product.add_to_cart' | t
                        else
                          assign quick_add_label = 'products.product.pre_order' | t
                        endif
                      -%}
                      <button type="submit" class="button button--primary pointer-events-auto" is="hover-button" data-variant-id="{{ product.selected_or_first_available_variant.id }}" aria-label="{{ quick_add_label | escape }}">
                        <span class="btn-fill" data-fill></span>
                        <span class="btn-text">
                          <span data-sold-out="{{ 'products.product.sold_out' | t | escape }}">
                            {{- quick_add_label -}}
                          </span>
                        </span>
                      </button>
                    {%- endform -%}
                  {% endcomment %}
                {%- else -%}                  
                  {%- if show_quick_view -%}
                    <button type="button" class="button button--primary pointer-events-auto shop-now-btn" is="hover-button" aria-controls="Quickview-{{ section_id }}-{{ block_id }}-{{ product.id }}" aria-expanded="false" aria-label="{{ 'products.product.choose_options' | t | escape }}">
                      <span class="btn-fill" data-fill></span>
                      <span class="btn-text">
                        {% comment %}{%- render 'icon', icon: 'cart', size: 'sm', class: 'md:hidden' -%}
                        <svg class="icon icon-cart icon-lg" viewBox="0 0 24 24" stroke="currentColor" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M1 1h.5v0c.226 0 .339 0 .44.007a3 3 0 0 1 2.62 1.976c.034.095.065.204.127.42l.17.597m0 0 1.817 6.358c.475 1.664.713 2.496 1.198 3.114a4 4 0 0 0 1.633 1.231c.727.297 1.592.297 3.322.297h2.285c1.75 0 2.626 0 3.359-.302a4 4 0 0 0 1.64-1.253c.484-.627.715-1.472 1.175-3.161l.06-.221c.563-2.061.844-3.092.605-3.906a3 3 0 0 0-1.308-1.713C19.92 4 18.853 4 16.716 4H4.857ZM12 20a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm8 0a2 2 0 1 1-4 0 2 2 0 0 1 4 0Z"></path>
                        </svg>
                        {% endcomment %}
                        <span class="inner-text">
                          {{- 'products.product.choose_options' | t -}}
                        </span>
                        {% render 'icon', icon: 'cart' %}
                      </span>
                    </button>
                  {%- else -%}
                    <a href="{{ product_url }}" class="button button--primary pointer-events-auto" is="hover-link" aria-label="{{ 'products.product.view_product' | t | escape }}">
                      <span class="btn-fill" data-fill></span>
                      <span class="btn-text">
                        {% comment %}{%- render 'icon', icon: 'cart', size: 'sm', class: 'md:hidden' -%}
                        <svg class="icon icon-cart icon-lg" viewBox="0 0 24 24" stroke="currentColor" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M1 1h.5v0c.226 0 .339 0 .44.007a3 3 0 0 1 2.62 1.976c.034.095.065.204.127.42l.17.597m0 0 1.817 6.358c.475 1.664.713 2.496 1.198 3.114a4 4 0 0 0 1.633 1.231c.727.297 1.592.297 3.322.297h2.285c1.75 0 2.626 0 3.359-.302a4 4 0 0 0 1.64-1.253c.484-.627.715-1.472 1.175-3.161l.06-.221c.563-2.061.844-3.092.605-3.906a3 3 0 0 0-1.308-1.713C19.92 4 18.853 4 16.716 4H4.857ZM12 20a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm8 0a2 2 0 1 1-4 0 2 2 0 0 1 4 0Z"></path>
                        </svg>
                        {% endcomment %}
                        {%- render 'icon', icon: 'cart' -%}
                        <span>
                          {{- 'products.product.view_product' | t -}}
                        </span>
                      </span>
                    </a>
                  {%- endif -%}
                {%- endif -%}
              </div>
            {%- endif -%}
          {%- else -%}
            <div class="quick-add pointer-events-none">
              <button type="button" class="button button--secondary button--blur" disabled="disabled">
                {{- 'products.product.sold_out' | t -}}
              </button>
            </div>
          {%- endif -%}
        </div>
      </div>

      {% assign pdcIcon = product.metafields.custom.pdc_icon.value %}
      {% assign pdcSpec = product.metafields.custom.pdc_spec.value %}
      {% if pdcIcon != blank or pdcSpec != blank %}
        <div class="product-card__spec">
        <div class="info_row">
        {% for icon in pdcIcon  limit: 4%}
          {% assign iconIndex = forloop.index0 %}
          {% for spec in pdcSpec %}
            {% if forloop.index0 == iconIndex %}
              {% assign titlePart = '' %}
              {% assign contentPart = '' %}
              {% if spec contains '--' %}
                {% assign titlePart = spec | split: '--' | last %}
                {% assign contentPart = spec | split: '--' | first %}
              {% else %}
                {% assign contentPart = spec %}
              {% endif %}
              <div class="info_col">
                {% comment %}
                  <div class="col_icon"><img src="{{ icon | img_url : 'small' }}" alt="" width="" height=""></div>
                {% endcomment %}
                <div class="col_spec">
                  {% if contentPart != blank %}
                    <p class="col-content">{{ contentPart }}</p>
                  {% endif %}
                  {% if titlePart != blank %}
                    <p class="col-title">{{ titlePart }}</p>
                  {% endif %}
                </div>
              </div>
            {% endif %}
          {% endfor %}
        {% endfor %}
        </div>
        </div>
      {% endif %}
    </div>
     
    {%- if show_quick_add and mobile_quick_add -%}
      <div class="lg:hidden">
        {%- if product.available -%}
          {%- if product.variants.size == 1 -%}
            {%- capture product_form_id -%}MobileQuickAddProductForm-{{ section_id }}-{{ product.id }}{%- endcapture -%}
            {%- form 'product', product, is: 'product-form', id: product_form_id -%}
              <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}" />
              <button type="submit" class="button button--primary button--small icon-with-text" is="hover-button" data-variant-id="{{ product.selected_or_first_available_variant.id }}">
                <span class="btn-fill" data-fill></span>
                <span class="btn-text">
                  {%- liquid
                    render 'icon', icon: 'plus', size: '2xs'
                    echo 'products.product.quick_add' | t
                  -%}
                </span>
              </button>
            {%- endform -%}
          {%- else -%}
            {%- if show_quick_view -%}
              <button type="button" class="button button--primary button--small icon-with-text" is="hover-button" aria-controls="Quickview-{{ section_id }}-{{ block_id }}-{{ product.id }}" aria-expanded="false">
                <span class="btn-fill" data-fill></span>
                <span class="btn-text">
                  {%- liquid
                    render 'icon', icon: 'plus', size: '2xs'
                    echo 'products.product.quick_view' | t
                  -%}
                </span>
              </button>
            {%- else -%}
              <a href="{{ product.url }}" class="button button--primary button--small icon-with-text" is="hover-link">
                <span class="btn-fill" data-fill></span>
                <span class="btn-text">
                  {%- liquid
                    render 'icon', icon: 'plus', size: '2xs'
                    echo 'products.product.quick_view' | t
                  -%}
                </span>
              </a>
            {%- endif -%}
          {%- endif -%}
        {%- else -%}
          <span class="button button--primary button--small" disabled="disabled">
            {{- 'products.product.sold_out' | t -}}
          </span>
        {%- endif -%}
      </div>
    {%- endif -%}
  </div>
{%- else -%}
  {%- render 'product-card-placeholder', placeholder: 'image', image_ratio: image_ratio, text_alignment: text_alignment, show_vendor: show_vendor, show_rating: show_rating -%}
{%- endif -%}

<script>
  addEventListener("DOMContentLoaded", (e) => { 
    const productCard{{ section.id | remove: '-' }}{{ product.id | remove: '-' }} = document.querySelector("#shopify-section-{{ section.id }} .product-card-{{ product.id }}"); 
    const varientImages{{ section.id | remove: '-' }}{{ product.id | remove: '-' }} = document.querySelectorAll("#shopify-section-{{ section.id }} .product-card-{{ product.id }} .varient-image-item"); 
    const swatches{{ section.id | remove: '-' }}{{ product.id | remove: '-' }} = document.querySelectorAll("#shopify-section-{{ section.id }} .product-card-{{ product.id }} .swatches li"); 
    
    swatches{{ section.id | remove: '-' }}{{ product.id | remove: '-' }}.forEach((swatch, i) => { 
      swatch.addEventListener("click", (event) => { 
        swatches{{ section.id | remove: '-' }}{{ product.id | remove: '-' }}.forEach((item, j) => { 
          item.classList.remove("active"); 
        }); 

        swatch.classList.add("active"); 

        const swatchColors{{ section.id | remove: '-' }}{{ product.id | remove: '-' }} = JSON.parse(event.currentTarget.getAttribute('data-color')); 

        swatchColors{{ section.id | remove: '-' }}{{ product.id | remove: '-' }}.forEach((swatchColor, j) => { 
          varientImages{{ section.id | remove: '-' }}{{ product.id | remove: '-' }}.forEach((varientImage, k) => { 
            const imgColors{{ section.id | remove: '-' }}{{ product.id | remove: '-' }} = JSON.parse(varientImage.getAttribute('data-color')); 

            imgColors{{ section.id | remove: '-' }}{{ product.id | remove: '-' }}.forEach((imgColor, m) => { 
              if(swatchColor == imgColor) { 
                varientImage.classList.add("active"); 
              } else { 
                varientImage.classList.remove("active"); 
              }
            }); 
          }); 
        }); 
      }); 
    }); 

    swatches{{ section.id | remove: '-' }}{{ product.id | remove: '-' }}[0].classList.add("active"); 
  }); 
</script>